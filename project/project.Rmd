---
title: "PROJECT TITLE"
author: "Zuck(R)berg"
date: "25 April 2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

Your project goes here! Before you submit, make sure your chunks are turned off with `echo = FALSE`. 

You can add sections as you see fit. Make sure you have a section called Introduction at the beginning and a section called Conclusion at the end. The rest is up to you!

### Introduction

### Stuff

```{r load-data, message=FALSE}
library(tidyverse)
library(dplyr)
library(broom)
library(stringr)

movies <- read_csv("/cloud/project/data/tmdb_5000_movies.csv")
movies <- movies %>%
  select(-id, -homepage, -original_title)
movies <- movies %>%
  filter(original_language == "en")
movies <- movies %>%
  filter(budget > 0) %>%
  filter(revenue > 0)

```

For our dataset of 5000 movies, we decided to remove the variables id, homepage, and original_title, since we felt that these variables did not contribute to our research question of what contributed to a "successful" movie. Additionally, since we found problems with the budget and revenue variables of non-American movies (not in US dollars), we decided to filter for only english movies as a proxy for American movies. (Since there is no definite way to filter for only American movies). 
We also filtered for movies that had a budget and revenue that were nonzero, this is so that our data would not be skewed by movies that were not intended to draw revenue or were not of the same budget caliber of the rest of the films. 

```{r popularity-explanations}
ggplot(data = movies, aes(y = popularity)) +
  geom_boxplot()

movies %>%
  select(title, popularity) %>%
  arrange(desc(popularity)) %>%
  head(10)
```

We are going to not look at popularity because we can't figure out where this came from,,, etc explain this.

```{r high-budget-list}
movies %>%
  select(title, budget) %>%
  arrange(desc(budget)) %>%
  head(10)
movies %>%
  distinct(production_companies)
```

### Creating a "Profitability" Variables

The first profitability variable is a ratio of revenue to budget, to show by what percentage a movie was "profitable."
This second profitability variable is a categorical variable that deciphers if the movie was profitable or not, based on the profitiability ratio. If the ratio was greater than 1, it was considered profitable. It will simply say "yes" for profitable, and "no" for non-profitable.

```{r}
movies <- movies %>% 
  mutate(pratio = revenue/budget) 
movies <- movies %>%
  mutate(profit = case_when(
    pratio > 1 ~ "yes",
    pratio <= 1 ~ "no"
  )
  )
movies <- movies %>%
  filter(pratio <= 200)

movies
```

### Making a Categorical "spoken languages" Variable 

Here, we will be creating a new vategorical variable, that signifies if the only language spoken in the film is english, or not. If the only spoken language is english, the value will be "yes," if there are other languages spoken or english is not used, the value will be "no."

```{r spoken-languages}

movies <- movies %>%
  mutate(spokenlength = str_length(spoken_languages))

movies <- movies %>%
  mutate(english = case_when(
    spokenlength == 40 ~ "yes",
    spokenlength > 40 ~ "no",
    spokenlength < 40 ~ "no"
  ))

```


### Splitting date variable

```{r separate-date-variable}
movies <- movies %>%
  separate(release_date, c("year", "month", "day"), sep = "-")

movies <- movies %>%
  mutate(year = as.numeric(year), month = as.numeric(month), day = as.numeric(day))
```
### Genre trends

```{r genre-trends}
movies <- movies %>%
  mutate(horror = ifelse(str_detect(genres, "Horror"), "yes", "no"))

horror_only <- movies %>%
  filter(horror == "yes") %>%
  group_by(year) %>%
  mutate(m_pratio = median(pratio)) 

ggplot(horror_only, aes(year, m_pratio)) +
  geom_bar(stat="identity") +
  labs(title = "Change in Median Profitability Ratio",
       x = "Year",
       y = "Median Profitability Ratio")
```

```{r horror}
horror_count <- horror_only %>%
  count(year)

ggplot(horror_count, aes(year, n)) +
  geom_bar(stat="identity") +
  labs(title = "Change in Number of Horror Movies",
       x = "Year",
       y = "# of Horror Movies")
```

### Making a variable for holiday releases

```{r holiday-variable}
movies <- movies %>%
  mutate(holiday_release = case_when(
    # Period between day before Christmas Eve and New Year's Eve (inclusive)
    month == 12 & day %in% c(23, 24, 25, 26, 27, 28, 29, 30, 31) ~ "yes",
    # New Year's Day (and the day after), flex period for Martin Luther King Jr. Day
    month == 1 & day %in% c(1, 2, 15, 16, 17, 18, 19, 20, 21) ~ "yes",
    # Valentine's Day (and the days before and after), flex period for Presidents' Day
    month == 2 & day %in% c(13, 14, 15, 16, 17, 18, 19, 20) ~ "yes",
    # Flex period for Memorial Day
    month == 5 & day %in% c(25, 26, 27, 28, 29, 30, 31) ~ "yes",
    # Independence Day (and the days before and after)
    month == 7 & day %in% c(3, 4, 5) ~ "yes",
    # Flex period for Labor Day
    month == 9 & day %in% c(1, 2, 3, 4, 5, 6, 7) ~ "yes",
    # Flex period for Thanksgiving, Veterans' Day (and the days before and after)
    month == 11 & day %in% c(10, 11, 12, 22, 23, 24, 25, 26, 27, 28) ~ "yes",
    TRUE ~ "no"
  ))
```

### Making a variable for likely sequels

```{r likely-sequel}
series <- movies$title %>%
  str_detect(":")

sequel2 <- movies$title %>%
  str_detect("2$")

sequel3 <- movies$title %>%
  str_detect("3")

movies <- movies %>%
  mutate(likely_sequel = case_when(
    series == TRUE ~ "yes",
    sequel2 == TRUE ~ "yes",
    sequel3 == TRUE ~ "yes",
    TRUE ~ "no"
  ))
```

### Making a variable for major production companies

```{r major-production-company}
universal_list <- movies$production_companies %>%
  str_detect("Universal Pictures")

paramount_list <- movies$production_companies %>%
  str_detect("Paramount Pictures")

warner_list <- movies$production_companies %>%
  str_detect("Warner Bros.")

disney_list <- movies$production_companies %>%
  str_detect("Walt Disney Pictures")

columbia_list <- movies$production_companies %>%
  str_detect("Columbia Pictures")

movies <- movies %>%
  mutate(if_major = case_when(
    universal_list == TRUE ~ "yes",
    paramount_list == TRUE ~ "yes",
    warner_list == TRUE ~ "yes", 
    disney_list == TRUE ~ "yes",
    columbia_list == TRUE ~ "yes",
    TRUE ~ "no"
  )) %>%
  mutate(major_productionco = case_when(
    universal_list == TRUE ~ "universal",
    paramount_list == TRUE ~ "paramount",
    warner_list == TRUE ~ "warner",
    disney_list == TRUE ~ "disney",
    columbia_list == TRUE ~ "columbia",
    TRUE ~ "other"
  ))
```

Major production companies according to Wikipedia are Universal Pictures (NBCUniversal), Paramount Pictures (Viacom), WarnerBros. Pictures (WarnerMedia), Walt Disney Pictures (Walt Disney Studios), Columbia Pictures (Sony Pictures) (in the format Major film studio unit (Studio parent) from https://en.wikipedia.org/wiki/Major_film_studio#Present_2).

### Making a variable for tagline length

```{r tagline-length}
movies <- movies %>%
  mutate(tag_length = str_length(tagline))
movies
```

### Making a preliminary linear model

```{r preliminary-linear-model}

m_pratio <- lm(revenue ~ holiday_release + likely_sequel + budget + runtime + if_major + major_productionco + tag_length + vote_average + vote_count, data = movies)
```

### Conclusion


